# ุฅุฏุงุฑุฉ ูููุงุช ุงูููุฌ (Log Management)

## ๐ ูุธุฑุฉ ุนุงูุฉ

ูููุงุช ุงูููุฌ ูู ุฌููุน ุงูุฎุฏูุงุช ูููู ุฃู ุชููุฃ ุงููุฑุต ุงูุตูุจ ูุน ุงูููุช ุฅุฐุง ูู ูุชู ุชูุธูููุง. ูุฐุง ุงููุณุชูุฏ ูุดุฑุญ ููููุฉ ุฅุฏุงุฑุฉ ูุชูุธูู ูููุงุช ุงูููุฌ.

## ๐ ููุงูุน ูููุงุช ุงูููุฌ

- **API Service**: `api-service/logs/`
  - `api-error.log` - ุฃุฎุทุงุก API
  - `api-out.log` - ุฅุฎุฑุงุฌ API
- **Socket Service**: `socket-service/logs/`
  - `socket-error.log` - ุฃุฎุทุงุก Socket
  - `socket-out.log` - ุฅุฎุฑุงุฌ Socket
- **Jobs Service**: `jobs-service/logs/`
  - `jobs-error.log` - ุฃุฎุทุงุก Jobs
  - `jobs-out.log` - ุฅุฎุฑุงุฌ Jobs

## โ๏ธ ุงูุชุฃุซูุฑ ุนูู ุงูุณูุฑูุฑ

### ุงููุดุงูู ุงููุญุชููุฉ:

1. **ููุก ุงููุฑุต ุงูุตูุจ**: ูููุงุช ุงูููุฌ ูููู ุฃู ุชููุฃ ุงููุฑุต ุงูุตูุจ ูุน ุงูููุช
2. **ุจุทุก ุงูุฃุฏุงุก**: ูููุงุช ุงูููุฌ ุงููุจูุฑุฉ ูููู ุฃู ุชุจุทุฆ ุนูููุงุช ุงููุฑุงุกุฉ/ุงููุชุงุจุฉ
3. **ุงุณุชููุงู ุงูุฐุงูุฑุฉ**: ุนูุฏ ูุฑุงุกุฉ ูููุงุช ููุฌ ูุจูุฑุฉุ ูููู ุฃู ุชุณุชููู ุฐุงูุฑุฉ ูุจูุฑุฉ

### ุงูุญููู ุงููุทุจูุฉ:

#### 1. PM2 Log Rotation (ูู pm2.config.js)

ุชู ุฅุถุงูุฉ ุฅุนุฏุงุฏุงุช log rotation ูู `pm2.config.js`:

- `max_size: "10M"` - ูุชู ุชุฏููุฑ ุงูููุฌ ุนูุฏ ูุตููู ุฅูู 10 ููุฌุงุจุงูุช
- `retain: 7` - ูุชู ุงูุงุญุชูุงุธ ุจู 7 ูููุงุช ููุฌ ูุฏูุฑุฉ
- `compress: true` - ูุชู ุถุบุท ูููุงุช ุงูููุฌ ุงููุฏูุฑุฉ

**ููุงุญุธุฉ**: PM2 ูุง ูุฏุนู log rotation ุจุดูู ูุจุงุดุฑ ูู ุงูุฅุตุฏุงุฑ 5.4.3. ูุฌุจ ุงุณุชุฎุฏุงู `pm2-logrotate` module.

#### 2. Scripts ุชูุธูู ูุฏูู

ุชู ุฅูุดุงุก scripts ูุชูุธูู ูููุงุช ุงูููุฌ:

- `scripts/cleanup-logs.sh` - ููุฃูุธูุฉ Linux/Mac
- `scripts/cleanup-logs.ps1` - ููุฃูุธูุฉ Windows

## ๐ ุงูุฅุนุฏุงุฏ ูุงูุงุณุชุฎุฏุงู

### 1. ุชุซุจูุช PM2 Log Rotate Module

```bash
# ุชุซุจูุช pm2-logrotate
pm2 install pm2-logrotate

# ุฅุนุฏุงุฏ pm2-logrotate
pm2 set pm2-logrotate:max_size 10M      # ุญุฌู ุงูููู ูุจู ุงูุชุฏููุฑ
pm2 set pm2-logrotate:retain 7          # ุนุฏุฏ ุงููููุงุช ุงููุญููุธุฉ
pm2 set pm2-logrotate:compress true     # ุถุบุท ุงููููุงุช
pm2 set pm2-logrotate:dateFormat YYYY-MM-DD_HH-mm-ss
pm2 set pm2-logrotate:rotateModule true
pm2 set pm2-logrotate:workerInterval 30 # ูุญุต ูู 30 ุซุงููุฉ
pm2 set pm2-logrotate:rotateInterval 0 2 * * * # ุชุฏููุฑ ููููุงู ูู ุงูุณุงุนุฉ 2 ุตุจุงุญุงู
pm2 set pm2-logrotate:retain 7          # ุงูุงุญุชูุงุธ ุจู 7 ูููุงุช
```

### 2. ุงุณุชุฎุฏุงู Scripts ุงูุชูุธูู ุงููุฏูู

#### ุนูู Linux/Mac:

```bash
# ุชุดุบูู script ุงูุชูุธูู
npm run cleanup-logs

# ุฃู ูุจุงุดุฑุฉ
bash scripts/cleanup-logs.sh
```

#### ุนูู Windows:

```powershell
# ุชุดุบูู script ุงูุชูุธูู
npm run cleanup-logs:win

# ุฃู ูุจุงุดุฑุฉ
powershell -File scripts/cleanup-logs.ps1
```

### 3. ุฅุนุฏุงุฏ ุชูุธูู ุชููุงุฆู (Cron Job)

#### ุนูู Linux/Mac:

```bash
# ูุชุญ crontab
crontab -e

# ุฅุถุงูุฉ ุงูุณุทุฑ ุงูุชุงูู ูุชูุธูู ุงูููุฌ ููููุงู ูู ุงูุณุงุนุฉ 2 ุตุจุงุญุงู
0 2 * * * cd /path/to/backend && ./scripts/cleanup-logs.sh >> ./logs/cleanup.log 2>&1
```

#### ุนูู Windows (Task Scheduler):

1. ุงูุชุญ Task Scheduler
2. ุฃูุดุฆ ูููุฉ ุฌุฏูุฏุฉ
3. ุงุถุจุทูุง ูุชุดุบูู ููููุงู ูู ุงูุณุงุนุฉ 2 ุตุจุงุญุงู
4. ุงูุฃูุฑ: `powershell.exe -File "C:\path\to\backend\scripts\cleanup-logs.ps1"`

## ๐ ูุฑุงูุจุฉ ุญุฌู ูููุงุช ุงูููุฌ

### ูุญุต ุญุฌู ูููุงุช ุงูููุฌ:

```bash
# Linux/Mac
du -sh api-service/logs socket-service/logs jobs-service/logs

# Windows PowerShell
Get-ChildItem -Path api-service\logs, socket-service\logs, jobs-service\logs -Recurse -File | Measure-Object -Property Length -Sum | Select-Object @{Name="Size(MB)";Expression={[math]::Round($_.Sum / 1MB, 2)}}
```

### ุนุฑุถ ุขุฎุฑ ุณุทูุฑ ูู ุงูููุฌ:

```bash
# ุนุฑุถ ุขุฎุฑ 100 ุณุทุฑ
pm2 logs api-service --lines 100

# ุนุฑุถ ุฃุฎุทุงุก ููุท
pm2 logs --err

# ุนุฑุถ ููุฌ ุฎุฏูุฉ ูุญุฏุฏุฉ
tail -f api-service/logs/api-error.log
```

## ๐งน ุชูุธูู ูุฏูู ููุฑู

### ุญุฐู ุฌููุน ูููุงุช ุงูููุฌ:

```bash
# Linux/Mac - ุงุญุฐุฑ: ุณูุญุฐู ุฌููุน ูููุงุช ุงูููุฌ
find . -name "*.log" -type f -delete
find . -name "*.log.gz" -type f -delete

# Windows PowerShell - ุงุญุฐุฑ: ุณูุญุฐู ุฌููุน ูููุงุช ุงูููุฌ
Get-ChildItem -Path . -Include *.log,*.log.gz -Recurse -File | Remove-Item -Force
```

### ุชูุธูู ูููุงุช ุงูููุฌ ุงููุฏููุฉ ููุท (ุฃูุฏู ูู 30 ููู):

```bash
# Linux/Mac
find . -name "*.log*" -type f -mtime +30 -delete

# Windows PowerShell
Get-ChildItem -Path . -Include *.log,*.log.gz -Recurse -File | Where-Object {$_.LastWriteTime -lt (Get-Date).AddDays(-30)} | Remove-Item -Force
```

## โ๏ธ ุฅุนุฏุงุฏุงุช PM2 Log Rotate ุงูููุตู ุจูุง

```bash
# ุญุฌู ุงูููู ูุจู ุงูุชุฏููุฑ (10 ููุฌุงุจุงูุช)
pm2 set pm2-logrotate:max_size 10M

# ุนุฏุฏ ุงููููุงุช ุงููุญููุธุฉ (7 ูููุงุช = ~70 ููุฌุงุจุงูุช ููู ุฎุฏูุฉ)
pm2 set pm2-logrotate:retain 7

# ุถุบุท ุงููููุงุช ุงููุฏูุฑุฉ
pm2 set pm2-logrotate:compress true

# ุชูุณูู ุงูุชุงุฑูุฎ ูู ุงุณู ุงูููู
pm2 set pm2-logrotate:dateFormat YYYY-MM-DD_HH-mm-ss

# ุชุฏููุฑ ููููุงู ูู ุงูุณุงุนุฉ 2 ุตุจุงุญุงู
pm2 set pm2-logrotate:rotateInterval 0 2 * * *

# ุญูุธ ุงูุฅุนุฏุงุฏุงุช
pm2 save
```

## ๐ ุชูุฏูุฑ ุงุณุชููุงู ุงููุณุงุญุฉ

ูุน ุงูุฅุนุฏุงุฏุงุช ุงูููุตู ุจูุง:

- **ูู ุฎุฏูุฉ**: 7 ูููุงุช ร 10 ููุฌุงุจุงูุช = ~70 ููุฌุงุจุงูุช (ูุถุบูุทุฉ ~20-30 ููุฌุงุจุงูุช)
- **ุฌููุน ุงูุฎุฏูุงุช**: 3 ุฎุฏูุงุช ร 70 ููุฌุงุจุงูุช = ~210 ููุฌุงุจุงูุช (ูุถุบูุทุฉ ~60-90 ููุฌุงุจุงูุช)

**ุจุฏูู ุชูุธูู**: ูููู ุฃู ุชุตู ูููุงุช ุงูููุฌ ุฅูู ุนุฏุฉ ุฌูุฌุงุจุงูุช ูุน ุงูููุช!

## โ ุฃูุถู ุงูููุงุฑุณุงุช

1. **ุงุณุชุฎุฏู pm2-logrotate**: ุชุซุจูุช ูุฅุนุฏุงุฏ pm2-logrotate ููุชุฏููุฑ ุงูุชููุงุฆู
2. **ุชูุธูู ุฏูุฑู**: ุฅุนุฏุงุฏ cron job ุฃู scheduled task ูุชูุธูู ุงููููุงุช ุงููุฏููุฉ
3. **ูุฑุงูุจุฉ ุงูุญุฌู**: ูุญุต ุญุฌู ูููุงุช ุงูููุฌ ุจุดูู ุฏูุฑู
4. **ุงูุงุญุชูุงุธ ุจุงููููุงุช ุงููููุฉ**: ูุง ุชุญุฐู ูููุงุช ุงูููุฌ ูุจู ุงูุชุฃูุฏ ูู ุนุฏู ุงูุญุงุฌุฉ ุฅูููุง
5. **ุถุบุท ุงููููุงุช ุงููุฏููุฉ**: ุถุบุท ูููุงุช ุงูููุฌ ุงูุฃูุฏู ูู 7 ุฃูุงู ูุชูููุฑ ุงููุณุงุญุฉ

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ูููุงุช ุงูููุฌ ูุง ูุชู ุชุฏููุฑูุง:

```bash
# ุงูุชุญูู ูู ุญุงูุฉ pm2-logrotate
pm2 list

# ุฅุนุงุฏุฉ ุชุซุจูุช pm2-logrotate
pm2 uninstall pm2-logrotate
pm2 install pm2-logrotate
pm2 save
```

### ูุณุงุญุฉ ุงููุฑุต ููุชูุฆุฉ:

```bash
# ูุญุต ุงููุณุงุญุฉ ุงููุณุชุฎุฏูุฉ
df -h  # Linux/Mac
Get-PSDrive C  # Windows PowerShell

# ุชูุธูู ููุฑู
npm run cleanup-logs  # Linux/Mac
npm run cleanup-logs:win  # Windows
```

## ๐ ููุงุญุธุงุช ูููุฉ

- ูููุงุช ุงูููุฌ ูููุฉ ูุงุณุชูุดุงู ุงูุฃุฎุทุงุกุ ูุง ุชุญุฐููุง ุฅูุง ุจุนุฏ ุงูุชุฃูุฏ
- ุงุญุชูุธ ุจูุณุฎุฉ ุงุญุชูุงุทูุฉ ูู ูููุงุช ุงูููุฌ ุงููููุฉ ูุจู ุงูุญุฐู
- ุฑุงุฌุน ูููุงุช ุงูููุฌ ุจุดูู ุฏูุฑู ููุชุญูู ูู ุงูุฃุฎุทุงุก ุงููุญุชููุฉ
- ุงุณุชุฎุฏู compression ูุชูููุฑ ุงููุณุงุญุฉ ูุน ุงูุงุญุชูุงุธ ุจุงููููุงุช
